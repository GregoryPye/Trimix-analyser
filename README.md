Those who are divers and have at least a Nitrox certification will know the value of analysing the gas you will be breathing (and there are many, myself included, who would argue that ALL divers should know about this).  For diving shallower than about 40 metres all that is generally needed is to check the oxygen content.  But, for deeper dives helium is often added to reduce the density of the gas and reduce nitrogen narcosis - this is then known as Trimix.

Gas analysers that measure helium as well as oxygen tend to cost well over Â£500 which is fine if thatâ€™s what it needs to be (this is safety critical stuff).  But, on the way back from a dive show I was chatting with some friends about what it would take to do something as accurate and reliable, but at a LOT lower cost that might mean more people would be able to have one.  On some very back of envelope thinking we thought we could get to something like Â£150.  That this isnâ€™t quite like for like since if I buy an analyser I am paying for CE type certifications, sales tax, their support, and the lack of hassle.  And, Iâ€™ll probably spend more designing, testing and making one than it would cost me to just buy it, even before I allow for my time â€¦ but whereâ€™s the fun in just buying stuff!  So this repository is to hold the thinking and supporting designs / code for an open source trimix analyser.

<strong>ABsOLUTELY NO WARRENTY IS GIVEN TO ANY PART OF THE MATERIAL HERE, OR ANY DEVICE MADE USING IT</strong>

There are four parts to our thinking, related to the key cost drivers â€“ the oxygen sensor, the helium sensor, the algorithms and output system that calculates and displays the answer, and â€˜the restâ€™ that takes it from a benchtop hack-up to a dive site level of robustness :-
<h3>Oxygen sensing â€“ Â£5</h3>
Almost all oxygen sensors are galvanic cells (basically a battery) whose output voltage is proportional to the partial pressure of Oxygen in the gas they are exposed to.  These cells cost around Â£50+, but we think we can get the cost to basically zero.  The logic is that many technical divers now use closed circuit rebreathers (CCRs), and these tend to have three oxygen sensors.  Their lifetime for measuring high partial pressures underwater is rather limited, so they get changed every year.  But, at atmospheric pressure they have a couple of years of useful life left in them, so they could be used for gas analysis with almost no cost (measuring a millivolts level voltage is easy stuff â€“ say Â£5). In fact, given the marginal cost of sensors is basically zero, it would be easy enough to use a pair of sensors which could help guard against one being too old and current limiting (they are unlikely to current limit at exactly the same point)

<h3>Helium sensing â€“ ~Â£25-50</h3>
Measuring helium in gas analysers is done using thermal conductivity or speed of sound.  The former is more common, but the rather nice Divesoft analyser uses speed of sound.

If you buy a discrete thermal conductivity based â€˜cellsâ€™  e.g. as a spare part, it is almost Â£200 which isnâ€™t great.  But, a bit more digging shows that matched pairs of â€˜pellistorsâ€™ can be bought for around Â£40 (e.g. see here).  Real cost would be a bit higher as they would need to be mounted well to provide good thermal matching.  Not bad, but it might be possible to do better.

The speed of sound approach relies on timing the duration between sending and receiving a pulse, and for the sake of containing the length of this post (fuller one to follow) appears to require timing precision down to a few microseconds.  But, with modern digital systems this is actually pretty easy, and more to the point should be fairly cheap, like Â£10 for emitters and detectors, maybe an extra Â£5 for fast sampling.  It might also need say Â£10 for a soundwave guide, though in practice the gas has to be routed through the device whatever method is used.  This may all prove to be wildly wishful thinking, and there are some proper signal filtering challenges to handle as the time sensitivity is shorter than the wavelength of most ultrasonic sensors.  But, â€˜measure the speed of sound in airâ€™ is regarded as a simple school level project for things like Arduino or Raspberry Pi, the approaches are similar so it should be possible, and anyway tinkering is fun ðŸ™‚ .
<h3>Algorithms, processing and display â€“ Â£50</h3>
Once upon a time decent digital processing and good displays were expensive.  Now they are cheap enough to allow use for hacking up all sorts of stuff, with Â£50 for hardware likely to give a bit of change.  The cost of devices isnâ€™t usually the hardware though, its the software and testing â€¦ but again thatâ€™s what hobby projects are all about; this is for fun!

For avoidance of any doubt, if this ever become something that was useful outside those who worked on it and/or had the knowledge and skills to build and test it themselves, it would take a LOT more testing cost, including CE certification if it was sold, at which point the price point would suddenly change quite a lot. It might not actually be a deal breaker for a commercial version, but it would certainly take some thought about whether it was worth it.
<h3>Other stuff â€“ Â£50</h3>
There is always other stuff.  Cases, batteries, faceplates, tubing and so on.  Thatâ€™s bound to cost a wee bit, with the case alone likely to be Â£20-30 (e.g. see here).  Say Â£50 all in.  On top of that one needs to allow for a flow rate reducer to get gas from a high pressure cylinder to the device.  But, other simple oxygen analysers often rely on just cracking open the cylinder valve, and its not obvious why that approach wouldnâ€™t work here, with a more sophisticated flow device used if desired.
<h3>So, what next?</h3>
Well, the thought experiment so far (including the speed of sound math which isnâ€™t in this post) feels like enough to make it worth a bit of playing.  The helium side is the key, so the next step is probably to get hold of some thermal pelistors and ultrasonic transmitters/receivers, and have a test-bench play
